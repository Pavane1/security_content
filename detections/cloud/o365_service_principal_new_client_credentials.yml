name: O365 Service Principal New Client Credentials
id: a1b229e9-d962-4222-8c62-905a8a010453
version: 1
date: '2023-08-31'
author: Mauricio Velazco, Splunk
status: production
type: TTP
description: The following analytic identifies the addition of new credentials for Service
  Principals in addition to existing legitimate credentials within a Office 365 tenant.
  These credentials include both x509 certificates and passwords. Adversaries
  and red teams alike who have obtained privileged access may add credentials
  to Service Principals and abuse them to obtain access to Office 365 mailboxes. 
search: '  Workload=AzureActiveDirectory Operation="Update application*Certificates and secrets management "
  | stats values(object) as object by _time, UserId, ModifiedProperties{}.NewValue
  | `o365_service_principal_new_client_credentials_filter`'
how_to_implement: UPDATE_HOW_TO_IMPLEMENT
known_false_positives: Service Principal client credential modifications may be part
  of legitimate administrative operations. Filter as needed.
references:
- REFERENCE
tags:
  analytic_story:
  - UPDATE_STORY_NAME
  asset_type: UPDATE asset_type
  atomic_guid:
  - UPDATE atomic_guid
  confidence: 50
  impact: 70
  message: New credentials added for Service Principal $object$
  mitre_attack_id:
  - T1098
  - T1098.001
  observable:
  - name: object
    type: User
    role:
    - Victim
  - name: UserId
    type: User
    role:
    - Attacker
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  risk_score: 35
  required_fields:
  - _time
  - Workload
  - Operation
  - object
  - UserId
  security_domain: identity
tests:
- name: True Positive Test
  attack_data:
  - data: UPDATE url to dataset
    source: UPDATE source
    sourcetype: UPDATE sourcetype
