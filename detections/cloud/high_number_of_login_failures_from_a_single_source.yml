name: High Number of Login Failures from a single source
id: 7f398cfb-918d-41f4-8db8-2e2474e02222
version: 2
date: '2020-12-16'
author: Bhavin Patel, Mauricio Velazco, Splunk
status: production
type: Anomaly
description: This search will detect more than 5 login failures in Office365 Azure
  Active Directory from a single source IP address. Please adjust the threshold value
  of 5 as suited for your environment.
data_source: []
search: '`o365_management_activity` Workload=AzureActiveDirectory Operation=UserLoginFailed record_type=AzureActiveDirectoryStsLogon 
  | bucket span=5m _time
  | stats dc(_raw) AS failed_attempts values(user) as user values(LogonError) as LogonError values(signature) as signature values(UserAgent) as UserAgent by _time, src_ip
  | where failed_attempts > 10
  | `high_number_of_login_failures_from_a_single_source_filter`'
how_to_implement: ''
known_false_positives: An Ip address with more than 20 failed authentication attempts
  in the span of 5 minutes may also be triggered by a broken application.
references: []
tags:
  analytic_story:
  - Office 365 Detections
  asset_type: Office 365
  confidence: 50
  impact: 50
  message: tbd
  mitre_attack_id:
  - T1110.001
  - T1110
  observable:
  - name: user
    type: User
    role:
    - Victim
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  required_fields:
  - _time
  - Operation
  - record_type
  - app
  - user
  - LogonError
  - authentication_method
  - signature
  - UserAgent
  - src_ip
  - record_type
  risk_score: 25
  security_domain: threat
tests:
- name: True Positive Test
  attack_data:
  - data: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1110.001/o365_high_number_authentications_for_user/o365_high_number_authentications_for_user.log
    source: o365
    sourcetype: o365:management:activity