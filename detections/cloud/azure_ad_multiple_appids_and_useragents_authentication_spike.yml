name: Azure AD Multiple AppIDs and UserAgents Authentication Spike
id: 5d8bb1f0-f65a-4b4e-af2e-fcdb88276314
version: 1
date: '2023-10-25'
author: Mauricio Velazco, Splunk
status: production
type: Anomaly
data_source:
- UPDATE_DATA_SOURCE
description: UPDATE_DESCRIPTION
search: ' `azuread` category=SignInLogs operationName="Sign-in activity" (properties.authenticationRequirement="multiFactorAuthentication" AND properties.status.additionalDetails="MFA required in Azure AD") OR (properties.authenticationRequirement=singleFactorAuthentication AND "properties.authenticationDetails{}.succeeded"=true)
   | bucket span=5m _time
   | stats  dc(_raw) as failed_attempts dc(properties.appId) as unique_app_ids dc(properties.userAgent) as unique_user_agents values(properties.appDisplayName) values(properties.deviceDetail.operatingSystem) by _time user src_ip
   | where failed_attempts > 5 and unique_app_ids > 2 and unique_user_agents > 5
   | `azure_ad_multiple_appids_and_useragents_authentication_spike_filter`'
how_to_implement: UPDATE_HOW_TO_IMPLEMENT
known_false_positives: UPDATE_KNOWN_FALSE_POSITIVES
references:
- REFERENCE
tags:
  analytic_story:
  - Azure Active Directory Account Takeover
  asset_type: UPDATE asset_type
  confidence: 80
  impact: 60
  message: UPDATE message
  mitre_attack_id:
  - T1078
  observable:
  - name: user
    type: User
    role:
    - Victim
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  risk_score: 48
  required_fields:
  - UPDATE_required_fields
  security_domain: identity
tests:
- name: True Positive Test
  attack_data:
  - data: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1078/azure_ad_multiple_appids_and_useragents_auth/azure_ad_multiple_appids_and_useragents_auth.log
    source: Azure AD
    sourcetype: azure:monitor:aad
