name: Windows Increase in Group or Object Modification Activity
id: 4f9564dd-a204-4f22-b375-4dfca3a68731
version: 1
date: '2023-10-13'
author: Dean Luxton
status: production
type: TTP
data_source:
- XmlWinEventLog:Security
description: Increase in group or AD object modifications. 
search: >-
  `wineventlog_security` EventCode IN (4670,4727,4731,4734,4735,4764)
  | bucket span=5m _time 
  | stats values(object) as object, dc(object) as objectCount, values(src_user_category) as src_user_category, values(dest) as dest, values(dest_category) as dest_category by _time, src_user, signature, status
  | eventstats avg(objectCount) as comp_avg, stdev(objectCount) as comp_std by src_user, signature
  | eval upperBound=(comp_avg+comp_std)
  | eval isOutlier=if(objectCount > 10 and (objectCount >= upperBound), 1, 0)
  | search isOutlier=1 
  | `windows_increase_in_group_or_object_modification_activity_filter`
how_to_implement: Run over past 7 days for best results. 
known_false_positives: Unknown
references: []
tags:
  analytic_story:
    - Sneaky Active Directory Persistence Tricks
  asset_type: Endpoint
  confidence: 40
  impact: 20
  message: Spike in Group or Object Modifications performed by $src_user$
  mitre_attack_id:
  - T1098
  observable:
  - name: src_user
    type: User
    role:
    - Victim
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  risk_score: 8
  required_fields:
  - EventCode
  - src_user
  - signature
  security_domain: audit
tests:
- name: True Positive Test
  attack_data:
  - data: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1098/account_manipulation/xml-windows-security.log
    source: XmlWinEventLog:Security
    sourcetype: XmlWinEventLog
