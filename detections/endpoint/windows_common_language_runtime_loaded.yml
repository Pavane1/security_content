name: Windows Common Language Runtime Loaded
id: aed3d140-5051-41d7-8fe9-af587700da4e
version: 1
date: '2023-02-23'
author: Mauricio Velazco, Splunk
type: TTP
datamodel: []
description: The following analytic 
search: ' `sysmon` EventCode=7 (ImageLoaded="*\\mscoreei.dll" OR ImageLoaded="*\\mscorlib.ni.dll" OR ImageLoaded="*\\amsi.dll") AND NOT (Image IN("C:\\Windows\\*", "C:\\Program File*", "%systemroot%\\*"))  
  | stats count min(_time) as firstTime max(_time) as lastTime by Image ImageLoaded Computer EventCode Signed ProcessId
  | `security_content_ctime(firstTime)`
  | `security_content_ctime(lastTime)`
  | `windows_common_language_runtime_loaded_filter`'
how_to_implement: This search needs Sysmon Logs and a sysmon configuration, which
  includes EventCode 7. This search uses an input macro named
  `sysmon`. We strongly recommend that you specify your environment-specific configurations
  (index, source, sourcetype, etc.) for Windows Sysmon logs. Replace the macro definition
  with configurations for your Splunk environment. The search also uses a post-filter
  macro designed to filter out known false positives.
known_false_positives: Legitimate non Windows applications may also load the Common Language runtime, filter as needed.
references:
- https://attack.mitre.org/techniques/T1620/
tags:
  analytic_story:
  - UPDATE_STORY_NAME
  asset_type: UPDATE asset_type
  cis20:
  - CIS 3
  - CIS 5
  - CIS 16
  confidence: 50
  context:
  - Source:Endpoint
  - Stage:Execution
  dataset:
  - https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1620/common_language_runtim_loaded/windows-sysmon.log
  impact: 40
  kill_chain_phases:
  - Weaponization
  - Exploitation
  - Installation
  - Command & Control
  message: UPDATE message
  mitre_attack_id:
  - T1620
  nist:
  - DE.CM
  observable:
  - name: Computer
    type: Endpoint
    role:
    - Victim
  - name: Image
    type: Process Name
    role:
    - Attacker
  - name: ImageLoaded
    type: File
    role:
    - Other
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  required_fields:
  - _time
  - Image
  - ImageLoaded
  - Computer
  - EventCode
  - Signed
  - ProcessId
  risk_score: 20
  security_domain: endpoint
